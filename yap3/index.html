<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bienvenido a Yape</title>
    
    <link rel="manifest" href="/manifest.json">
    
    <meta name="theme-color" content="#742284">
    
    <link rel="apple-touch-icon" href="/img/favicon.png">

    <script>
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(reg => console.log('¡Motor de App conectado!', reg.scope))
                    .catch(err => console.error('Error de conexión:', err));
            });
        }
    </script>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --brand-purple: #742385;
            --brand-dark: #511973;
            --brand-teal: #00BFA5;
        }
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            margin: 0;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--brand-purple);
            background-image: linear-gradient(135deg, #742385 0%, #511973 100%);
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        /* --- CSS RESTAURADO --- */
        .logo-container { margin-bottom: 40px; text-align: center; }

        .logo-img {
            width: 120px; height: 120px; object-fit: contain;
            border-radius: 20px; 
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }

        .welcome-text { font-size: 24px; font-weight: 700; margin-bottom: 10px; text-align: center; }

        .sub-text {
            font-size: 15px; opacity: 0.8; margin-bottom: 40px;
            text-align: center; max-width: 300px; line-height: 1.4;
        }

        /* --- BOTONES --- */
        .btn-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
            max-width: 320px;
        }

        .btn-google {
            background-color: white; color: #333;
            width: 100%; padding: 15px;
            border-radius: 12px; border: none;
            font-size: 16px; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
            gap: 12px; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s;
            text-decoration: none;
        }

        .btn-access {
            background-color: rgba(255, 255, 255, 0.15); 
            color: white;
            width: 100%; padding: 15px;
            border-radius: 12px; 
            border: 1px solid rgba(255, 255, 255, 0.3);
            font-size: 16px; font-weight: 600;
            display: flex; align-items: center; justify-content: center;
            gap: 12px; cursor: pointer;
            transition: background 0.2s;
            text-decoration: none;
        }
        
        .btn-google:active, .btn-access:active { transform: scale(0.97); }
        .btn-access:hover { background-color: rgba(255, 255, 255, 0.25); }

        .google-icon { width: 24px; height: 24px; }

        /* --- FOOTER --- */
        .footer-links {
            position: absolute; bottom: 30px;
            font-size: 13px; opacity: 0.8;
            text-align: center; width: 100%;
            display: flex; justify-content: center; gap: 20px;
        }
        
        .footer-link { color: white; text-decoration: none; cursor: pointer; border-bottom: 1px solid transparent; }
        .footer-link:hover { border-bottom: 1px solid white; }

        /* --- MODAL TÉRMINOS --- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.6); z-index: 2000;
            display: none; justify-content: center; align-items: center;
            padding: 20px; backdrop-filter: blur(5px);
        }

        .modal-card {
            background: white; color: #333;
            width: 100%; max-width: 340px;
            border-radius: 20px; padding: 25px;
            text-align: center;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes popIn { 0% { transform: scale(0.8); opacity: 0; } 100% { transform: scale(1); opacity: 1; } }

        .modal-title { font-size: 20px; font-weight: 700; margin-bottom: 15px; color: var(--brand-purple); }
        
        .modal-body {
            font-size: 14px; line-height: 1.5; color: #555; margin-bottom: 20px; text-align: left;
        }
        
        .warning-text { color: #d32f2f; font-weight: 700; margin-top: 10px; display: block; border: 1px solid #ffcdd2; background: #ffebee; padding: 10px; border-radius: 8px; }
        
        .dev-credits { font-size: 12px; color: #888; margin-top: 15px; font-weight: 600; display: block; }

        .btn-telegram {
            background-color: #229ED9; color: white;
            width: 100%; padding: 12px; border: none; border-radius: 10px;
            font-weight: 600; font-size: 15px; cursor: pointer;
            margin-bottom: 10px; text-decoration: none; display: block;
        }

        .btn-close {
            background: #eee; color: #333;
            width: 100%; padding: 12px; border: none; border-radius: 10px;
            font-weight: 600; cursor: pointer;
        }
    </style>
</head>
<body>

    <div id="pantallaInstalacion" style="position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: #742284; z-index: 999999; display: flex; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; font-family: 'Inter', sans-serif;">
        <img src="img/favicon.png" alt="Logo" style="width: 100px; margin-bottom: 20px; border-radius: 20px;">
        <h2 style="font-size: 22px; margin-bottom: 10px;">Instala la aplicación para continuar</h2>
        <p style="font-size: 14px; color: #e0e0e0; margin-bottom: 30px; max-width: 80%;">Para una experiencia segura y rápida, debes añadir Yape a tu pantalla de inicio.</p>
        
        <button id="btnInstalarApp" style="background-color: white; color: #742284; border: none; padding: 15px 30px; border-radius: 30px; font-weight: 700; font-size: 16px; cursor: pointer; display: none; box-shadow: 0 5px 15px rgba(0,0,0,0.3);">
            <i class="fa-solid fa-download"></i> Agregar pantalla inicio
        </button>
    </div>

    <div class="logo-container">
        <img src="img/animationyape.gif" alt="Logo" class="logo-img">
    </div>

    <div class="welcome-text">Te damos la bienvenida</div>
    <div class="sub-text">Únete a la comunidad de más de 10 millones de yaperos.</div>

    <div class="btn-container">
        <button class="btn-google" onclick="iniciarSesion()">
            <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="G" class="google-icon">
            Continuar con Google
        </button>

        <a href="https://t.me/MaikolEsleiter" class="btn-access">
            <i class="fa-brands fa-telegram" style="font-size: 20px;"></i>
            Obtén acceso
        </a>
    </div>

    <div class="footer-links">
        <span class="footer-link" onclick="openModal()">Términos y Condiciones</span>
        <a href="https://t.me/MaikolEsleiter" class="footer-link">Centro de Ayuda</a>
    </div>

    <div class="modal-overlay" id="termsModal">
        <div class="modal-card">
            <div class="modal-title">Términos y Condiciones</div>
            <div class="modal-body">
                <strong>Lee atentamente esto:</strong><br><br>
                El personal de administración no se hace responsable del mal uso de la app. No hay devoluciones ni cargos a enfrentar.<br>
                
                <span class="warning-text">
                    <i class="fa-solid fa-triangle-exclamation"></i>
                    NO TOLERAMOS el uso de varios dispositivos enlazados. Si compartes acceso, tu cuenta quedará BANEADA DE FORMA PERMANENTE.
                </span>
                <br>
                Tendrás que comprar otro acceso para remediar eso. Avisados están.
                
                <span class="dev-credits">Desarrollador/Dev: @MaikolEsleiter</span>
            </div>

            <a href="https://t.me/appsreborn" class="btn-telegram">
                <i class="fa-brands fa-telegram"></i> Grupo Oficial
            </a>
            
            <button class="btn-close" onclick="closeModal()">Entendido</button>
        </div>
    </div>

    <script>
        const pantallaInstalacion = document.getElementById('pantallaInstalacion');
        const btnInstalar = document.getElementById('btnInstalarApp');
        let promptDiferido;

        // 2. VERIFICAR SI YA ESTÁ INSTALADA
        if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true) {
            pantallaInstalacion.style.display = 'none';
        } else {
            // 3. SI NO ESTÁ INSTALADA, PREPARAMOS EL BOTÓN
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault(); 
                promptDiferido = e; 
                btnInstalar.style.display = 'block'; 
            });

            // 4. AL HACER CLIC EN "AGREGAR PANTALLA INICIO"
            btnInstalar.addEventListener('click', async () => {
                if (promptDiferido) {
                    promptDiferido.prompt(); 
                    const { outcome } = await promptDiferido.userChoice;
                    if (outcome === 'accepted') {
                        promptDiferido = null;
                    }
                }
            });

            // 5. CUANDO SE INSTALA CORRECTAMENTE, QUITAMOS EL BLOQUEO
            window.addEventListener('appinstalled', () => {
                pantallaInstalacion.style.display = 'none';
            });
        }

        // Lógica del Modal de Términos
        const modal = document.getElementById('termsModal');
        function openModal() { modal.style.display = 'flex'; }
        function closeModal() { modal.style.display = 'none'; }
        window.onclick = function(event) { if (event.target == modal) closeModal(); }
    </script>

    <script type="module" src="firebase.js"></script>
    
    <script type="module">
        import { verificarSiYaEntro } from "./firebase.js"; 
        if(window.verificarSiYaEntro) window.verificarSiYaEntro();
    </script>
</body>
</html>